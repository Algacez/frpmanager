<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <title>FRP 文件管理</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="bg-orb"></div>
  <div class="container">
    <header class="hero">
      <div>
        <h1>FRP 文件管理</h1>
        <p class="sub">快速切换目录、编辑配置，并管理多个 FRPC 实例。</p>
      </div>
      <a class="btn" href="{{ url_for('service_page') }}">服务管理</a>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="messages">
          {% for category, msg in messages %}
            <div class="msg {{ category }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <section class="card">
      <h2>当前目录</h2>
      <div class="row">
        <div class="path">{{ directory }}</div>
        <form method="post" action="/set-dir" class="inline">
          <input type="text" name="dir" placeholder="/path/to/dir" />
          <button type="submit">切换/添加</button>
        </form>
      </div>
      <div class="row">
        <form method="post" action="/create-dir" class="inline">
          <input type="text" name="new_dir" placeholder="新建目录（支持相对路径）" />
          <button type="submit">新建并切换</button>
        </form>
      </div>
      <div class="row">
        <label>已管理目录:</label>
        <div class="tag-list">
          {% for d in settings.managed_dirs %}
            <form method="post" action="/set-dir" class="inline">
              <input type="hidden" name="dir" value="{{ d }}" />
              <button type="submit" class="tag">{{ d }}</button>
            </form>
            <form method="post" action="/remove-dir" class="inline">
              <input type="hidden" name="dir" value="{{ d }}" />
              <button type="submit" class="tag danger">移除</button>
            </form>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="card">
      <div class="row between">
        <h2>配置文件</h2>
        <form method="post" action="/create-file" class="inline">
          <input type="text" name="new_file" placeholder="新建 config.toml" />
          <button type="submit">新建</button>
        </form>
      </div>
      {% if files %}
        <ul class="file-list">
          {% for f in files %}
            <li>
              <a href="{{ url_for('edit_file', filename=f.name) }}">{{ f.name }}</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="empty">当前目录下没有 toml 文件</div>
      {% endif %}
    </section>

    <section class="card">
      <h2>服务状态</h2>
      <div class="row">
        <div>frps: {{ '运行中' if states.frps.running else '未运行' }} (守护: {{ '是' if states.frps.desired else '否' }})</div>
      </div>
      <div class="divider"></div>
      <div class="row wrap">
        {% if states.frpc_instances %}
          {% for inst in states.frpc_instances %}
            <div class="pill">
              <strong>{{ inst.id }}</strong>
              <span>{{ '运行中' if inst.running else '未运行' }}</span>
              <span>守护: {{ '是' if inst.desired else '否' }}</span>
            </div>
          {% endfor %}
        {% else %}
          <div class="empty">还没有 FRPC 实例</div>
        {% endif %}
      </div>
    </section>
  </div>
</body>
</html>
